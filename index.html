<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalMarket Connect</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for chat messages */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Inter Font */
        body {
            font-family: "Inter", sans-serif;
            overflow-y: scroll; /* Allow body to scroll */
        }

        /* Ensure main content area expands and scrolls independently */
        #app-content {
            min-height: calc(100vh - 120px - 80px); /* Adjust height to fill space above footer and below header */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col font-sans relative pb-20 sm:pb-24">

    <!-- Header (Top Bar) -->
    <header id="app-header" class="sticky top-0 z-10 w-full bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-4 shadow-lg flex items-center justify-between rounded-b-xl">
        <div class="flex items-center">
            <button id="back-button" class="p-2 mr-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white hidden">
                <!-- Lucide ArrowLeft Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
            </button>
            <h1 id="header-title" class="text-xl font-bold font-inter tracking-wide">LocalMarket Connect</h1>
        </div>
        <div class="flex items-center space-x-3">
            <button class="p-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white">
                <!-- Lucide Search Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </button>
            <button class="p-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white">
                <!-- Lucide Bell Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.36 14.16a3.5 3.5 0 0 0 3.28 0"/></svg>
            </button>
            <!-- Home button in the header -->
            <button id="home-button-header" class="p-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white">
                <!-- Lucide Home Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-content" class="flex-1 overflow-y-auto pt-4 pb-4">
        <!-- Content will be rendered here by JavaScript -->
    </main>

    <!-- Navigation Bar (Bottom Bar) -->
    <nav class="fixed bottom-0 z-20 w-full bg-white border-t border-gray-200 shadow-xl flex justify-around py-2 rounded-t-xl">
        <button id="nav-home" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-purple-700 font-semibold">
            <!-- Lucide Home Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home mb-1"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span class="text-xs font-inter">Home</span>
        </button>
        <button id="nav-categories" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide LayoutGrid Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid mb-1"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
            <span class="text-xs font-inter">Categories</span>
        </button>
        <button id="nav-sell" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide Plus Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus mb-1"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
            <span class="text-xs font-inter">Sell</span>
        </button>
        <button id="nav-chat" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide MessageCircle Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle mb-1"><path d="M7.9 20A9.9 9.9 0 1 0 4 16.1L2 22Z"/></svg>
            <span class="text-xs font-inter">Chat</span>
        </button>
        <button id="nav-profile" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide User Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user mb-1"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span class="text-xs font-inter">Profile</span>
        </button>
    </nav>

    <!-- Firebase JS SDKs (removed, but keeping the script tag for organization) -->
    <script type="module">
        // NO FIREBASE IMPORTS IN THIS MOCKUP VERSION

        // --- Mock Data ---
        const mockProducts = [
            {
                id: 'p1',
                name: 'Custom Tailoring Services',
                category: 'Services',
                description: 'Expert tailoring for all your clothing needs â€“ repairs, alterations, and custom designs. Perfect fit guaranteed!',
                price: 80.00,
                imageUrl: 'https://placehold.co/300x200/F5F3FF/8B5CF6?text=Tailoring',
                location: 'Central Market Area'
            },
            {
                id: 'p2',
                name: 'Homemade Spicy Kerepek',
                category: 'Food & Drink',
                description: 'Crispy and delicious homemade kerepek with a spicy kick! Perfect snack for any time.',
                price: 15.00,
                imageUrl: 'https://placehold.co/300x200/F0F9FF/0EA5E9?text=Kerepek',
                location: 'Taman Bahagia'
            },
            {
                id: 'p3',
                name: 'Vintage Leather Handbag',
                category: 'Fashion',
                description: 'A classic vintage leather handbag, well-maintained and stylish. A timeless accessory.',
                price: 120.00,
                imageUrl: 'https://placehold.co/300x200/FDF2F8/EC4899?text=Handbag',
                location: 'Bandar Sunway'
            },
            {
                id: 'p4',
                name: 'Gaming PC (Used)',
                category: 'Electronics',
                description: 'High-performance gaming PC, recently upgraded. Runs all modern games smoothly.',
                price: 2500.00,
                imageUrl: 'https://placehold.co/300x200/ECFDF5/10B981?text=Gaming+PC',
                location: 'Cyberjaya'
            },
            {
                id: 'p5',
                name: 'Hand-knitted Baby Blanket',
                category: 'Babies & Kids',
                description: 'Soft and warm hand-knitted blanket, ideal for newborns and toddlers. Hypoallergenic yarn.',
                price: 45.00,
                imageUrl: 'https://placehold.co/300x200/FEF2F2/EF4444?text=Baby+Blanket',
                location: 'Wangsa Maju'
            },
            {
                id: 'p6',
                name: 'Organic Honey (Local)',
                category: 'Food & Drink',
                description: 'Pure, raw, and organic honey sourced from local farms. Great for health and taste.',
                price: 35.00,
                imageUrl: 'https://placehold.co/300x200/FFFBEB/F59E0B?text=Honey',
                location: 'Ampang'
            },
            {
                id: 'p7',
                name: 'Personal Fitness Coaching',
                category: 'Services',
                description: 'Certified personal trainer offering one-on-one fitness coaching sessions. Achieve your health goals!',
                price: 200.00,
                imageUrl: 'https://placehold.co/300x200/F0F9FF/06B6D4?text=Coaching',
                location: 'Mont Kiara'
            },
            {
                id: 'p8',
                name: 'Vintage Wooden Chair',
                category: 'Home Goods',
                description: 'Beautifully crafted vintage wooden chair, perfect as a decorative piece or for daily use. Solid build.',
                price: 90.00,
                imageUrl: 'https://placehold.co/300x200/F3F4F6/6B7280?text=Chair',
                location: 'Petaling Jaya'
            },
        ];

        const allCategories = [
            'All',
            'Services',
            'Food & Drink',
            'Fashion',
            'Electronics',
            'Home Goods',
            'Babies & Kids',
            'Vehicles',
            'Real Estate',
            'Jobs',
            'Pets'
        ];

        const mockChatRooms = [
            {
                id: 'general_community',
                name: 'General Community Chat',
                description: 'A place for all community members to connect.',
                type: 'public',
                createdAt: new Date().toISOString()
            },
            {
                id: 'mothers_sanctuary',
                name: "Mothers' Sanctuary",
                description: 'A supportive space exclusively for mothers.',
                type: 'mothers',
                createdAt: new Date().toISOString()
            },
            {
                id: 'local_foodies',
                name: "Local Foodies",
                description: 'Share your favorite local eats and recipes!',
                type: 'public',
                createdAt: new Date().toISOString()
            }
        ];

        // Mock messages for each room (static, for display only)
        const mockMessages = {
            'general_community': [
                { senderId: 'user123', text: 'Hey everyone, anyone selling old books?', timestamp: Date.now() - 3600000 },
                { senderId: 'user456', text: 'I have a few! What genre are you looking for?', timestamp: Date.now() - 3500000 },
                { senderId: 'user123', text: 'Mostly fiction and fantasy.', timestamp: Date.now() - 3400000 },
            ],
            'mothers_sanctuary': [
                { senderId: 'mom_of_2', text: 'Hi moms! Any recommendations for baby-friendly cafes in PJ?', timestamp: Date.now() - 7200000 },
                { senderId: 'super_mom', text: 'The Little Muffin Cafe near Section 14 is great!', timestamp: Date.now() - 7100000 },
                { senderId: 'new_mama', text: 'Yes, I second Little Muffin! Their play area is a lifesaver.', timestamp: Date.now() - 7000000 },
                { senderId: 'mom_of_2', text: 'Thanks for the tips!', timestamp: Date.now() - 6900000 },
            ],
            'local_foodies': [
                { senderId: 'food_lover', text: 'Just tried the new nasi lemak stall. So good!', timestamp: Date.now() - 10800000 },
                { senderId: 'eater_pro', text: 'Where is it? Need to check it out!', timestamp: Date.now() - 10700000 },
                { senderId: 'food_lover', text: 'It\'s at the corner of Jalan SS2/7. Look for the red awning.', timestamp: Date.now() - 10600000 },
            ]
        };


        // --- App State (Vanilla JS equivalent) ---
        let currentPage = 'home'; // 'home', 'categories', 'sell', 'chat', 'profile', 'chatDetail', 'productDetail'
        let currentChatRoomId = null;
        let currentChatRoomName = '';
        let searchTerm = '';
        let selectedCategory = 'All';
        let selectedProduct = null; // For product detail view
        const currentUserId = 'mock_user_123'; // A fixed user ID for the mockup

        let chatMessages = {}; // To store dynamic messages added in mockup

        const appContent = document.getElementById('app-content');
        const headerTitle = document.getElementById('header-title');
        const backButton = document.getElementById('back-button');
        const homeButtonHeader = document.getElementById('home-button-header');
        const navButtons = {
            home: document.getElementById('nav-home'),
            categories: document.getElementById('nav-categories'),
            sell: document.getElementById('nav-sell'),
            chat: document.getElementById('nav-chat'),
            profile: document.getElementById('nav-profile'),
        };

        // --- Navigation Functions ---
        const handleNavigate = (page) => {
            currentPage = page;
            currentChatRoomId = null;
            currentChatRoomName = '';
            selectedProduct = null;
            renderPage(currentPage);
            updateNavActiveState(currentPage);
        };

        const updateNavActiveState = (activePage) => {
            Object.keys(navButtons).forEach(key => {
                const button = navButtons[key];
                if (key === activePage) {
                    button.classList.add('text-purple-700', 'font-semibold');
                    button.classList.remove('text-gray-500', 'hover:text-purple-600');
                } else {
                    button.classList.remove('text-purple-700', 'font-semibold');
                    button.classList.add('text-gray-500', 'hover:text-purple-600');
                }
            });
        };

        const updateHeader = () => {
            const pageTitles = {
                home: 'LocalMarket Connect',
                categories: 'Categories',
                sell: 'Sell Item',
                chat: 'Community Chats',
                chatDetail: currentChatRoomName,
                productDetail: selectedProduct ? selectedProduct.name : 'Product Details',
                profile: 'My Profile',
            };
            headerTitle.textContent = pageTitles[currentPage];

            if (currentPage !== 'home') {
                backButton.classList.remove('hidden');
            } else {
                backButton.classList.add('hidden');
            }
        };

        backButton.addEventListener('click', () => {
            if (currentPage === 'chatDetail') {
                handleNavigate('chat');
            } else if (currentPage === 'productDetail') {
                handleNavigate('home'); // Go back to home from product detail
            } else {
                handleNavigate('home'); // Fallback to home for other back actions
            }
        });

        homeButtonHeader.addEventListener('click', () => {
            handleNavigate('home');
        });

        // --- Page Rendering Functions ---

        const renderHomePage = () => {
            updateHeader();
            let html = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter text-center">LocalMarket Connect</h2>
                    <p class="text-gray-600 mb-6 font-inter text-center">Discover amazing deals and connect with your local community.</p>

                    <!-- Location Search Input (Placeholder for future feature) -->
                    <div class="bg-white p-6 rounded-xl shadow-md mb-6 flex items-center justify-between">
                        <div class="flex items-center">
                            <!-- Lucide MapPin Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin text-purple-600 mr-2"><path d="M12 17.5l-4-4H8a5 5 0 1 1 8 0h-4l4 4zM12 2a8 8 0 0 1 8 8c0 7.2-9 12-9 12S4 17.2 4 10a8 8 0 0 1 8-8z"/></svg>
                            <span class="font-semibold text-gray-800 font-inter">Location: <span class="font-normal text-gray-600">Your Area (Click to change)</span></span>
                        </div>
                        <button class="text-purple-600 hover:text-purple-800 transition-colors duration-200">
                            <!-- Lucide Search Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        </button>
                    </div>

                    <!-- General Search Bar -->
                    <div class="mb-6">
                        <input
                            type="text"
                            id="product-search-input"
                            value="${searchTerm}"
                            placeholder="Search products, services..."
                            class="w-full p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-700 font-inter shadow-sm"
                        />
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-md mb-6">
                        <h3 class="text-xl font-semibold text-purple-700 mb-3 font-inter">Featured Listings</h3>
                        <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Products will be rendered here -->
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="text-xl font-semibold text-purple-700 mb-3 font-inter">Local Events</h3>
                        <p class="text-gray-500 font-inter">Check out upcoming community events near you!</p>
                        <img
                          src="https://placehold.co/300x100/d0d0d0/444444?text=Event+Banner"
                          alt="Event Banner"
                          class="w-full h-24 object-cover rounded-lg mt-4"
                          onerror="this.onerror=null;this.src='https://placehold.co/300x100/d0d0d0/444444?text=Image+Load+Error';"
                        />
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            // Add event listener for search input
            const searchInput = document.getElementById('product-search-input');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchTerm = e.target.value;
                    renderProductCards(filteredProducts()); // Re-render products with new search term
                });
            }

            // Initial render of product cards
            renderProductCards(filteredProducts());
        };

        const renderProductCards = (productsToRender) => {
            const productListDiv = document.getElementById('product-list');
            if (!productListDiv) return;

            if (productsToRender.length === 0) {
                productListDiv.innerHTML = '<p class="text-gray-500 font-inter text-center col-span-full">No products found matching your criteria.</p>';
                return;
            }

            productListDiv.innerHTML = productsToRender.map(product => `
                <button
                    class="product-card block w-full bg-gray-50 rounded-xl shadow-md overflow-hidden transform hover:scale-[1.02] transition-transform duration-200 cursor-pointer text-left"
                    data-product-id="${product.id}"
                >
                    <img
                        src="${product.imageUrl}"
                        alt="${product.name}"
                        class="w-full h-40 object-cover"
                        onerror="this.onerror=null;this.src='https://placehold.co/300x200/e0e0e0/555555?text=Image+Error';"
                    />
                    <div class="p-4">
                        <h4 class="text-lg font-semibold text-gray-800 mb-1 font-inter">${product.name}</h4>
                        <p class="text-sm text-gray-600 mb-2 font-inter flex items-center">
                            <!-- Lucide Tag Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-1 text-purple-500"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414L12.586 22.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
                            ${product.category}
                        </p>
                        <p class="text-md font-bold text-purple-700 font-inter flex items-center">
                            <!-- Lucide Euro Icon (used as placeholder for MYR) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-euro mr-1"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 4.5-2"/></svg>
                            MYR ${product.price.toFixed(2)}
                        </p>
                        <p class="text-xs text-gray-500 mt-2 font-inter flex items-center">
                            <!-- Lucide MapPin Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-1"><path d="M12 17.5l-4-4H8a5 5 0 1 1 8 0h-4l4 4zM12 2a8 8 0 0 1 8 8c0 7.2-9 12-9 12S4 17.2 4 10a8 8 0 0 1 8-8z"/></svg>
                            ${product.location}
                        </p>
                    </div>
                </button>
            `).join('');

            // Add event listeners for each product card
            productListDiv.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', () => {
                    const productId = card.dataset.productId;
                    const product = mockProducts.find(p => p.id === productId);
                    if (product) {
                        selectedProduct = product;
                        handleNavigate('productDetail');
                    }
                });
            });
        };

        const filteredProducts = () => {
            return mockProducts.filter(product => {
                const matchesSearch = searchTerm.toLowerCase() === '' ||
                                      product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      product.description.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'All' || product.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });
        };


        const renderCategoriesPage = () => {
            updateHeader();
            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Browse Categories</h2>
                    <p class="text-gray-600 mb-6 font-inter">Find exactly what you're looking for!</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        ${allCategories.map(category => `
                            <button
                                class="category-button bg-white p-4 rounded-xl shadow-md flex flex-col items-center justify-center text-center hover:bg-purple-50 transition-colors duration-200 cursor-pointer"
                                data-category="${category}"
                            >
                                <!-- Lucide LayoutGrid Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid text-purple-500 mb-2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                                <span class="font-inter text-gray-700 text-sm">${category}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            appContent.querySelectorAll('.category-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    selectedCategory = e.currentTarget.dataset.category;
                    searchTerm = ''; // Clear search term when category is selected
                    handleNavigate('home');
                });
            });
        };

        const renderProductDetailPage = () => {
            updateHeader();
            if (!selectedProduct) {
                appContent.innerHTML = `<div class="text-center text-gray-500 p-8 font-inter">Product not found.</div>`;
                return;
            }

            let html = `
                <div class="p-4">
                    <div class="bg-white p-6 rounded-xl shadow-md max-w-lg mx-auto">
                        <img
                            src="${selectedProduct.imageUrl}"
                            alt="${selectedProduct.name}"
                            class="w-full h-64 object-cover rounded-lg mb-4"
                            onerror="this.onerror=null;this.src='https://placehold.co/400x300/e0e0e0/555555?text=Image+Error';"
                        />
                        <h2 class="text-3xl font-bold text-gray-900 mb-2 font-inter">${selectedProduct.name}</h2>
                        <p class="text-xl font-bold text-purple-700 mb-4 font-inter flex items-center">
                            <!-- Lucide Euro Icon (used as placeholder for MYR) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-euro mr-1"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 4.5-2"/></svg>
                            MYR ${selectedProduct.price.toFixed(2)}
                        </p>
                        <p class="text-gray-700 mb-4 font-inter">${selectedProduct.description}</p>
                        <div class="flex items-center text-gray-600 mb-2 font-inter">
                            <!-- Lucide Tag Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-2 text-purple-500"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414L12.586 22.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
                            Category: <span class="font-semibold ml-1">${selectedProduct.category}</span>
                        </div>
                        <div class="flex items-center text-gray-600 mb-4 font-inter">
                            <!-- Lucide MapPin Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-2 text-purple-500"><path d="M12 17.5l-4-4H8a5 5 0 1 1 8 0h-4l4 4zM12 2a8 8 0 0 1 8 8c0 7.2-9 12-9 12S4 17.2 4 10a8 8 0 0 1 8-8z"/></svg>
                            Location: <span class="font-semibold ml-1">${selectedProduct.location}</span>
                        </div>
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 transform hover:scale-105 flex items-center justify-center">
                            <!-- Lucide ShoppingCart Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart mr-2"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                            Message Seller
                        </button>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;
        };


        const renderSellPage = () => {
            updateHeader();
            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Sell Your Item</h2>
                    <p class="text-gray-600 mb-6 font-inter">Turn your unused items into cash!</p>
                    <div class="bg-white p-6 rounded-xl shadow-md max-w-md mx-auto">
                        <div class="mb-4">
                            <label for="title" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Title</label>
                            <input type="text" id="title" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., Vintage Lamp" />
                        </div>
                        <div class="mb-4">
                            <label for="description" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Description</label>
                            <textarea id="description" rows="3" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Describe your item..."></textarea>
                        </div>
                        <div class="mb-6">
                            <label for="price" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Price (MYR)</label>
                            <input type="number" id="price" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., 50.00" />
                        </div>
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 transform hover:scale-105">
                            List Item
                        </button>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;
        };

        const renderChatRoomsPage = () => {
            updateHeader();
            let html = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter text-center">Community Chat Rooms</h2>
                    <p class="text-gray-600 mb-6 font-inter text-center">Join discussions and connect with neighbors!</p>
                    <div id="chat-rooms-list" class="space-y-4">
                        <!-- Chat rooms will be rendered here -->
                    </div>
                    <p class="text-xs text-gray-500 text-center mt-6 font-inter">Your User ID: <span class="font-mono text-purple-700 break-all">${currentUserId}</span></p>
                </div>
            `;
            appContent.innerHTML = html;

            // Render mock chat rooms
            const chatRoomsListDiv = document.getElementById('chat-rooms-list');
            if (chatRoomsListDiv) {
                if (mockChatRooms.length === 0) {
                    chatRoomsListDiv.innerHTML = '<div class="bg-white p-6 rounded-xl shadow-md text-center text-gray-500 font-inter">No chat rooms available.</div>';
                } else {
                    chatRoomsListDiv.innerHTML = mockChatRooms.map(room => `
                        <button
                            class="chat-room-button block w-full text-left bg-white p-5 rounded-xl shadow-md hover:bg-purple-50 transition-colors duration-200 cursor-pointer group"
                            data-room-id="${room.id}"
                            data-room-name="${room.name}"
                        >
                            <div class="flex items-center mb-2">
                                <!-- Lucide MessageCircle Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle text-purple-600 group-hover:text-purple-700 mr-3"><path d="M7.9 20A9.9 9.9 0 1 0 4 16.1L2 22Z"/></svg>
                                <h3 class="text-lg font-semibold text-gray-800 font-inter group-hover:text-purple-800">${room.name}</h3>
                            </div>
                            <p class="text-gray-500 text-sm font-inter">${room.description}</p>
                            ${room.type === 'mothers' ? `
                                <span class="mt-2 inline-block bg-pink-100 text-pink-700 text-xs font-semibold px-2.5 py-0.5 rounded-full font-inter">
                                    <!-- Lucide Megaphone Icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone inline-block mr-1"><path d="m3 11 18-2L13 22 3 11z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/><path d="M11.6 16.8c1.3-1 2.3-2.3 3-3.6"/><path d="M3 11h3"/></svg>
                                    Mothers Only
                                </span>
                            ` : ''}
                        </button>
                    `).join('');

                    chatRoomsListDiv.querySelectorAll('.chat-room-button').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const roomId = e.currentTarget.dataset.roomId;
                            const roomName = e.currentTarget.dataset.roomName;
                            currentChatRoomId = roomId;
                            currentChatRoomName = roomName;
                            handleNavigate('chatDetail');
                        });
                    });
                }
            }
        };

        const renderChatRoomDetail = () => {
            updateHeader();
            let html = `
                <div class="flex flex-col h-[calc(100vh-120px)] sm:h-[calc(100vh-130px)] bg-gray-50 rounded-xl shadow-inner mx-auto max-w-screen-md">
                    <!-- Messages display area -->
                    <div id="messages-display-area" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                        <!-- Messages will be rendered here -->
                    </div>

                    <!-- Message input area -->
                    <div class="p-4 bg-white border-t border-gray-200 flex items-center rounded-b-xl">
                        <input
                            type="text"
                            id="new-message-input"
                            value=""
                            placeholder="Message in ${currentChatRoomName}..."
                            class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-700 font-inter"
                        />
                        <button id="send-message-button" class="ml-3 bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-full shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-200">
                            <!-- Lucide ArrowUp Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up"><path d="M12 19V5"/><path d="m5 12 7-7 7 7"/></svg>
                        </button>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            const messageInput = document.getElementById('new-message-input');
            const sendMessageButton = document.getElementById('send-message-button');
            const messagesDisplayArea = document.getElementById('messages-display-area');

            // Initialize chatMessages for the current room if not already done
            if (!chatMessages[currentChatRoomId]) {
                chatMessages[currentChatRoomId] = [...(mockMessages[currentChatRoomId] || [])];
            }
            
            const renderCurrentRoomMessages = () => {
                const msgs = chatMessages[currentChatRoomId] || [];
                if (messagesDisplayArea) {
                    if (msgs.length === 0) {
                        messagesDisplayArea.innerHTML = `<div class="text-center text-gray-500 p-4 font-inter">No messages yet. Be the first to say hello!</div>`;
                    } else {
                        messagesDisplayArea.innerHTML = msgs.map(msg => `
                            <div class="flex ${msg.senderId === currentUserId ? 'justify-end' : 'justify-start'}">
                                <div class="max-w-[75%] p-3 rounded-lg shadow-sm font-inter
                                    ${msg.senderId === currentUserId
                                        ? 'bg-purple-600 text-white rounded-br-none'
                                        : 'bg-white text-gray-800 rounded-bl-none border border-gray-200'
                                    }"
                                >
                                    <p class="text-xs text-gray-300 mb-1 font-semibold">${msg.senderId === currentUserId ? 'You' : `User ${msg.senderId.substring(0, 8)}...`}</p>
                                    <p class="text-sm break-words">${msg.text}</p>
                                    <span class="block text-right text-xs mt-1 opacity-75">
                                        ${new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                    </span>
                                </div>
                            </div>
                        `).join('');
                        messagesDisplayArea.scrollTop = messagesDisplayArea.scrollHeight; // Scroll to bottom
                    }
                }
            };

            renderCurrentRoomMessages(); // Initial render of messages for the room

            const localSendMessage = () => {
                const messageText = messageInput.value.trim();
                if (messageText) {
                    const newMsg = { senderId: currentUserId, text: messageText, timestamp: Date.now() };
                    chatMessages[currentChatRoomId].push(newMsg);
                    messageInput.value = ''; // Clear input field
                    renderCurrentRoomMessages(); // Re-render messages
                }
            };

            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') localSendMessage();
                });
            }
            if (sendMessageButton) {
                sendMessageButton.addEventListener('click', localSendMessage);
            }
        };

        const renderProfilePage = () => {
            updateHeader();
            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Your Profile</h2>
                    <p class="text-gray-600 mb-6 font-inter">Manage your account and listings.</p>
                    <div class="bg-white p-6 rounded-xl shadow-md max-w-md mx-auto">
                        <img
                          src="https://placehold.co/100x100/A78BFA/FFFFFF?text=JP"
                          alt="User Avatar"
                          class="rounded-full mx-auto mb-4 border-4 border-purple-200"
                          onerror="this.onerror=null;this.src='https://placehold.co/100x100/A78BFA/FFFFFF?text=Error';"
                        />
                        <p class="text-xl font-semibold text-gray-800 font-inter">Hello, Local User!</p>
                        <p class="text-gray-500 mb-4 font-inter">Member since 2024</p>
                        <button class="bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 hover:bg-purple-200">
                            Edit Profile
                        </button>
                        <div class="mt-4 text-left space-y-2">
                            <p class="text-gray-600 font-inter"><span class="font-semibold">Listings:</span> 5 active</p>
                            <p class="text-gray-600 font-inter"><span class="font-semibold">Orders:</span> 2 completed</p>
                            <p class="text-gray-600 font-inter"><span class="font-semibold">Rating:</span> 4.8/5.0</p>
                        </div>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;
        };

        const renderPage = (page) => {
            switch (page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'categories':
                    renderCategoriesPage();
                    break;
                case 'sell':
                    renderSellPage();
                    break;
                case 'chat':
                    renderChatRoomsPage();
                    break;
                case 'chatDetail':
                    renderChatRoomDetail();
                    break;
                case 'productDetail':
                    renderProductDetailPage();
                    break;
                case 'profile':
                    renderProfilePage();
                    break;
                default:
                    renderHomePage();
                    break;
            }
        };

        // --- Event Listeners for Navigation ---
        navButtons.home.addEventListener('click', () => handleNavigate('home'));
        navButtons.categories.addEventListener('click', () => handleNavigate('categories'));
        navButtons.sell.addEventListener('click', () => handleNavigate('sell'));
        navButtons.chat.addEventListener('click', () => handleNavigate('chat'));
        navButtons.profile.addEventListener('click', () => handleNavigate('profile'));

        // --- Initialize App ---
        document.addEventListener('DOMContentLoaded', () => {
            // No Firebase initialization needed for this mock-up
            renderPage(currentPage);
            updateNavActiveState(currentPage);
        });

    </script>
</body>
</html>
